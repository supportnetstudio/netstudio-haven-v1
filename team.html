<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>The Haven â€” The Collective</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">

  <script src="https://unpkg.com/lucide@latest"></script>
  <style>
    /* --- CORE VARIABLES --- */
    :root {
      --bg-body: #FDFBF7; 
      --bg-alt: #F3EFE7; 
      --text-main: #3D3A36; 
      --text-muted: #8C8680;
      --accent: #B08968; 
      --font-heading: 'Playfair Display', serif;
      --font-body: 'Lato', sans-serif;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { background: var(--bg-body); color: var(--text-main); font-family: var(--font-body); line-height: 1.6; overflow-x: hidden; }

    h1, h2, h3 { font-family: var(--font-heading); font-weight: 400; color: #2C2926; }
    h1 { font-size: clamp(36px, 5vw, 64px); line-height: 1.1; margin-bottom: 20px; }
    
    .subtitle {
      font-family: var(--font-body); font-size: 10px; letter-spacing: 0.2em; 
      text-transform: uppercase; color: var(--accent); display: block; margin-bottom: 12px;
    }

    .container { max-width: 1000px; margin: 0 auto; padding: 0 40px; }
    .btn { display: inline-block; background: #2C2926; color: white; padding: 12px 28px; border-radius: 50px; text-decoration: none; font-size: 12px; letter-spacing: 0.05em; transition: 0.3s; }
    .btn:hover { background: var(--accent); transform: translateY(-2px); }

    nav { padding: 20px 40px; display: flex; justify-content: space-between; align-items: center; }
    .logo { font-family: var(--font-heading); font-size: 24px; font-weight: 600; letter-spacing: -0.02em; font-style: italic; }
    .nav-links { display: flex; gap: 40px; }
    .nav-links a { color: var(--text-main); text-decoration: none; font-size: 14px; }

    .team-hero { text-align: center; padding: 60px 0 80px; }
    .team-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 40px; }
    .artist-card { text-align: center; display: flex; flex-direction: column; align-items: center; margin-bottom: 40px; transition: 0.3s; }
    .artist-card:hover { transform: translateY(-5px); }

    .img-arch { width: 100%; aspect-ratio: 3/4; border-radius: 150px 150px 0 0; overflow: hidden; margin-bottom: 24px; position: relative; }
    .artist-img { width: 100%; height: 100%; object-fit: cover; filter: grayscale(100%); transition: 0.5s ease; }
    .artist-card:hover .artist-img { filter: grayscale(0%); transform: scale(1.05); }

    .artist-name { font-size: 24px; margin-bottom: 4px; }
    .artist-role { font-size: 11px; color: var(--accent); text-transform: uppercase; letter-spacing: 0.1em; display: block; margin-bottom: 20px; }

    .btn-outline { border: 1px solid var(--text-muted); color: var(--text-main); padding: 10px 24px; border-radius: 50px; font-size: 11px; text-transform: uppercase; letter-spacing: 0.1em; text-decoration: none; transition: 0.2s; cursor: pointer; }
    .btn-outline:hover { border-color: var(--accent); color: var(--accent); }

    .join-cta { background: var(--bg-alt); padding: 80px 0; text-align: center; margin-top: 40px; }
    footer { padding: 60px 0 30px; text-align: center; color: var(--text-muted); font-size: 12px; }
    @media(max-width: 900px) { .team-grid { grid-template-columns: 1fr 1fr; } }
    @media(max-width: 600px) { .team-grid { grid-template-columns: 1fr; } .nav-links { display: none; } }
  </style>
</head>
<body>

  <nav>
    <div class="logo" id="ns_brand">The Haven</div>
    <div class="nav-links">
      <a href="index.html">Home</a>
      <a href="services.html">Services</a>
      <a href="about.html">Our Story</a>
    </div>
    <a href="#book" class="btn" onclick="nsOpenBooking(); return false;">Book</a>
  </nav>

  <header class="container team-hero">
    <span class="subtitle" id="team_kicker">The Collective</span>
    <h1 id="team_heading">Meet The Artisans.</h1>
    <p id="team_text" style="font-size: 18px; font-weight: 300; max-width: 600px; margin: 20px auto 0; color: var(--text-muted);"></p>
  </header>

  <main class="container">
    <div class="team-grid" id="team_grid">
      <div style="grid-column:1/-1;text-align:center;color:var(--text-muted);padding:40px 0;">Loading team...</div>
    </div>
  </main>

  <footer>
    <div class="container">
      <div id="ns_footer_brand" style="font-family: var(--font-heading); font-size: 24px; margin-bottom: 20px;">The Haven</div>
      <p id="ns_footer_address" style="margin-bottom: 20px;"></p>
      <p>&copy; 2026 The Haven. Powered by Net Studio.</p>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    const SB_URL = "https://jdvdgvolfmvlgyfklbwe.supabase.co";
    const SB_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpkdmRndm9sZm12bGd5ZmtsYndlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM1Mjk5MDgsImV4cCI6MjA3OTEwNTkwOH0.xiAOgWof9En3jbCpY1vrYpj3HD-O6jMHbamIHTSflek";
    const sb = supabase.createClient(SB_URL, SB_KEY);

    function nsGetSlug() {
      const q = new URLSearchParams(location.search).get("b");
      if (q) return q.toLowerCase();
      const h = location.hostname.toLowerCase();
      const R = "netstudiodevelopment.com";
      if (!h || h === "localhost" || h.startsWith("127.") || h === R || h === "www." + R) return null;
      if (h.endsWith("." + R)) return h.slice(0, -(R.length + 1)).split(".")[0];
      return null;
    }

    const SLUG = nsGetSlug();

    function nsOpenBooking(payload = {}) {
      if (window.NetStudio?.open) return window.NetStudio.open(payload);
      if (window.openBooking) return window.openBooking(payload);
      console.warn("Booking engine loading...");
    }

    async function loadHavenTeam() {
      if (!SLUG) return;

      const { data: biz } = await sb.from("business")
        .select("id, name, street_address, city, state")
        .eq("slug", SLUG).maybeSingle();
      
      if (!biz) return;

      // Branding & Address
      const bName = biz.name || "The Haven";
      if(document.getElementById("ns_brand")) document.getElementById("ns_brand").textContent = bName;
      if(document.getElementById("ns_footer_brand")) document.getElementById("ns_footer_brand").textContent = bName;
      if(document.getElementById("ns_footer_address")) {
        document.getElementById("ns_footer_address").textContent = [biz.street_address, biz.city, biz.state].filter(Boolean).join(", ");
      }

      // Hero Copy from Unified JSON
      const { data: site } = await sb.from("business_sites")
        .select("content_json")
        .eq("business_id", biz.id)
        .eq("template_key", "haven_v1").maybeSingle();

      if (site?.content_json?.team) {
        const t = site.content_json.team;
        if(document.getElementById("team_kicker")) document.getElementById("team_kicker").textContent = t.kicker || "The Collective";
        if(document.getElementById("team_heading")) document.getElementById("team_heading").textContent = t.heading || "Meet The Artisans.";
        if(document.getElementById("team_text")) document.getElementById("team_text").textContent = t.text || "";
      }

      // Team Members
      const { data: members } = await sb.from("team_members")
        .select("id, name, role, profile_image_url, photo_url")
        .eq("business_id", biz.id)
        .eq("is_active", true)
        .not("auth_user_id", "is", null);

      const grid = document.getElementById("team_grid");
      grid.innerHTML = (members || []).map(m => `
        <div class="artist-card">
          <div class="img-arch">
            <img src="${m.profile_image_url || m.photo_url || 'https://via.placeholder.com/600x800'}" class="artist-img">
          </div>
          <h3 class="artist-name">${m.name}</h3>
          <span class="artist-role">${m.role}</span>
          <a href="#" class="btn-outline" onclick="nsOpenBooking({ staff_id: '${m.id}' }); return false;">Book</a>
        </div>
      `).join("") || `<div style="grid-column:1/-1;text-align:center;padding:40px 0;">No active artisans yet.</div>`;
    }

    loadHavenTeam();
  </script>
</body>
</html>
